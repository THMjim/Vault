# SQL Reference
## **References**
- https://static.offsec.com/offsec-courses/HACKTRACK-WITH-MENTORS/SQL_Injection_Attacks.pdf
- https://pentestmonkey.net/category/cheat-sheet/sql-injection
- https://www.advania.co.uk/blog/security/mysql-sql-injection-practical-cheat-sheet/
- https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection
- https://portswigger.net/web-security/sql-injection/cheat-sheet 
- https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html 
- https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-mysql.html
---
## Terms
- **In-band SQL Injection** occurs when an attacker is able to inject malicious SQL and view the results directly through the same communication channel, typically through application ºs response. 
 - **Error-based SQL Injection:** Relies on database error messages to extract data.
- **Union-based SQL Injection:** Uses the UNION SQL operator to combine results of a malicious query with the original query.
- information_schema = the system database
- schemata = a table inside information_schema (lists all databases) 
- schema_name = a column in schemata (shows the name of each database)
- tables = a table inside information_schema (lists all tables in all databases) 
- table_schema = a column in tables (shows which database each table belongs to)
---
## Connect to DBs
---
### MySQL
* Connect to remote SQL instance
* Default creds??
* Note:  when using impacket, the  HELP functionality is VERY helpful, `Enum_db`
```sql
mysql -u root -p'root' -h 192.168.50.16 -P 3306 --skip-ssl-verify-server-cert
# --skip-ssl is to bypass ERROR 2026 (HY000) TLS/SSL

select version();		# Version info
select system_user();	# current database user
show databases;			# list all databases
use mysql;              # switich to DB 
show tables;            # list all tables in DB

SELECT user, authentication_string FROM mysql.user WHERE user = 'offsec';	# query user/pass

# auth string is Caching-SHA-256 algorithm (https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html)
```
---
### MSSQL
- MSSQL can be access via Impacket
- Default creds? SA?
```SQL
impacket-mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth
# -windows-auth forces NTLM (instead of kerberos)

SELECT @@version;				# Version info

SELECT name FROM sys.databases;	# list all databases

SELECT * FROM offsec.information_schema.tables;	# QUERY tables in offsec DB

select * from offsec.dbo.users;	# QUERY all users in offsec DB

```

